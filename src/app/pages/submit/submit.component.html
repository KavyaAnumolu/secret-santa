<div class="submit-shell">

  <!-- Top header -->
  <div class="top mat-elevation-z2">
    <div class="top-row">
      <div>
        <div class="top-title">Secret Santa Preferences üéÅ</div>

        <div class="top-meta" *ngIf="loadedExisting; else newUser">
          <span class="pct">Loaded your saved answers ‚Äî edit anything</span>
        </div>

        <ng-template #newUser>
          <div class="top-meta">
            <span class="pct">Fill what you can ‚Äî Next unlocks at 80%</span>
          </div>
        </ng-template>
      </div>

      <div class="dots" aria-hidden="true">
        <span
          class="dot"
          *ngFor="let s of steps; let i = index"
          [class.active]="i === stepIndex"
        ></span>
      </div>
    </div>

    <div class="progress-wrap">
      <mat-progress-bar mode="determinate" [value]="overallProgress()"></mat-progress-bar>
    </div>
  </div>

  <!-- Card Carousel Area -->
  <div
    class="card-stage"
    (touchstart)="onTouchStart($event)"
    (touchend)="onTouchEnd($event)"
  >
    <mat-card class="card mat-elevation-z3" [ngClass]="currentStep.themeClass">

      <!-- Header -->
      <div class="card-head">
        <div class="head-icon">
          <mat-icon aria-hidden="true">{{ currentStep.icon }}</mat-icon>
        </div>

        <div class="head-text">
          <div class="head-title">{{ currentStep.title }}</div>
          <div class="head-sub">{{ currentStep.subtitle }}</div>
        </div>

        <div class="head-count">
          {{ stepIndex + 1 }}/{{ steps.length }}
        </div>

        <!-- Jump to any section -->
        <button mat-stroked-button type="button" [matMenuTriggerFor]="sectionMenu">
          <mat-icon>edit</mat-icon>
          Edit
        </button>

        <mat-menu #sectionMenu="matMenu">
          <button
            mat-menu-item
            *ngFor="let s of steps; let i = index"
            (click)="goToStep(i)"
          >
            <mat-icon>{{ s.icon }}</mat-icon>
            <span>{{ s.title }}</span>
          </button>
        </mat-menu>
      </div>

      <!-- Scrollable body -->
      <div class="card-body">
        <form [formGroup]="form" class="fields" (keydown.enter)="onEnterKey($event)">

          <!-- BASICS -->
          <ng-container *ngIf="currentStep.id === 'basics'">
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Name / Nickname *</mat-label>
              <input matInput formControlName="name" placeholder="e.g., Kavya" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Birthday / Zodiac</mat-label>
              <input matInput formControlName="birthday" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite color</mat-label>
              <input matInput formControlName="favoriteColor" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite snack</mat-label>
              <input matInput formControlName="favoriteSnack" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite drink</mat-label>
              <input matInput formControlName="favoriteDrink" />
            </mat-form-field>
          </ng-container>

          <!-- FOOD -->
          <ng-container *ngIf="currentStep.id === 'food'">
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Sweet or salty?</mat-label>
              <input matInput formControlName="sweetOrSalty" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite candy</mat-label>
              <input matInput formControlName="favoriteCandy" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite dessert</mat-label>
              <input matInput formControlName="favoriteDessert" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite fast food</mat-label>
              <input matInput formControlName="favoriteFastFood" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Allergies / dislikes</mat-label>
              <textarea matInput rows="2" formControlName="foodAllergies"></textarea>
            </mat-form-field>
          </ng-container>

          <!-- INTERESTS -->
          <ng-container *ngIf="currentStep.id === 'interests'">
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite movie / genre</mat-label>
              <input matInput formControlName="favoriteMovie" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite TV show</mat-label>
              <input matInput formControlName="favoriteTV" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite music</mat-label>
              <input matInput formControlName="favoriteMusic" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Hobbies</mat-label>
              <textarea matInput rows="2" formControlName="hobbies"></textarea>
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Obsessed with lately</mat-label>
              <textarea matInput rows="2" formControlName="obsession"></textarea>
            </mat-form-field>
          </ng-container>

          <!-- COMFORT -->
          <ng-container *ngIf="currentStep.id === 'comfort'">
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Cozy night in or going out?</mat-label>
              <input matInput formControlName="cozyOrOut" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Coffee or tea?</mat-label>
              <input matInput formControlName="coffeeOrTea" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Morning person or night owl?</mat-label>
              <input matInput formControlName="morningOrNight" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite scent</mat-label>
              <input matInput formControlName="favoriteScent" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite season</mat-label>
              <input matInput formControlName="favoriteSeason" />
            </mat-form-field>
          </ng-container>

          <!-- STYLE -->
          <ng-container *ngIf="currentStep.id === 'style'">
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Go-to outfit</mat-label>
              <input matInput formControlName="goToOutfit" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite accessory</mat-label>
              <input matInput formControlName="favoriteAccessory" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite store / brand</mat-label>
              <input matInput formControlName="favoriteStore" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Casual or dressy?</mat-label>
              <input matInput formControlName="casualOrDressy" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite emoji</mat-label>
              <input matInput formControlName="favoriteEmoji" />
            </mat-form-field>
          </ng-container>

          <!-- RANDOM -->
          <ng-container *ngIf="currentStep.id === 'random'">
            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Introvert or extrovert?</mat-label>
              <input matInput formControlName="introvertOrExtrovert" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite cartoon / anime character</mat-label>
              <input matInput formControlName="favoriteCartoonCharacter" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite cartoon / anime show</mat-label>
              <input matInput formControlName="favoriteCartoonShow" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Dream vacation destination</mat-label>
              <input matInput formControlName="favoriteVacationSpot" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Your personality in 3 words</mat-label>
              <input matInput formControlName="personalityIn3Words" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>One thing you‚Äôre currently learning</mat-label>
              <input matInput formControlName="currentlyLearning" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite song</mat-label>
              <input matInput formControlName="favoriteSong" placeholder="Song name / artist" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Favorite quote or saying</mat-label>
              <input matInput formControlName="favoriteQuote" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>A small thing that makes you happy</mat-label>
              <textarea matInput rows="2" formControlName="smallJoy"></textarea>
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Something you always need more of</mat-label>
              <input matInput formControlName="needMoreOf" />
            </mat-form-field>

            <mat-form-field appearance="outline" floatLabel="always">
              <mat-label>Dream gift (big or small)</mat-label>
              <textarea matInput rows="2" formControlName="dreamGift"></textarea>
            </mat-form-field>
          </ng-container>

        </form>

        <div class="hint">
          {{ filledCount(currentStep.keys) }}/{{ totalCount(currentStep.keys) }} answered
          <span *ngIf="!canGoNext()">
            ‚Äî answer {{ requiredCount(currentStep.keys) - filledCount(currentStep.keys) }} more to continue
          </span>
        </div>
      </div>

      <!-- Sticky footer -->
      <div class="card-footer">
        <div class="nav">
          <button mat-stroked-button type="button" (click)="back()" [disabled]="stepIndex === 0 || loading">
            <mat-icon>arrow_back</mat-icon>
            Back
          </button>

          <div class="nav-right">
            <button
              mat-raised-button
              color="primary"
              type="button"
              (click)="next()"
              *ngIf="stepIndex < steps.length - 1"
              [disabled]="!canGoNext() || loading"
            >
              Next
              <mat-icon>arrow_forward</mat-icon>
            </button>

            <button
              mat-raised-button
              color="primary"
              type="button"
              (click)="save()"
              [disabled]="!canGoNext() || loading"
            >
              {{ loading ? 'Saving‚Ä¶' : 'Save changes üíæ' }}
            </button>
          </div>
        </div>
      </div>

    </mat-card>
  </div>

</div>

<app-footer></app-footer>
